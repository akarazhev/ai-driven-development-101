# M2: Core Pageing Flows

Implement the core functionality: creating pages, uploading attachment, scheduling, and publishing. This milestone builds the
essential features of your application.

## Learning objectives

- Implement attachment upload functionality
- Create page management endpoints
- Build scheduling system
- Implement publish flow
- Create basic UI for core features

## Prerequisites

- M1 completed (project scaffold working)
- Database schema in place
- Stub provider implemented

## Acceptance criteria

- [ ] Can upload attachment files
- [ ] Can create pages with text and attachment
- [ ] Can schedule pages for future
- [ ] Can publish pages imattachmenttely
- [ ] Can view page status
- [ ] Basic UI for compose and schedules
- [ ] Scheduler processes queued pages

## Step-by-step guide

### Step 1: Implement attachment upload

**Backend endpoint**:

```text
Role: Backend developer
Task: Implement attachment upload endpoint
Constraints:
- Endpoint: POST /api/attachment
- Accept: multipart/form-data with file and optional alt_text
- Validate: file type, size limits
- Store: file to storage, metadata to database
- Return: AttachmentAsset object with id
- Include error handling
Inputs: [Storage setup, database models]
Output format: Attachment upload endpoint + tests
Evaluation: Can upload files, metadata saved, validation works
```

**Frontend component**:

```text
Role: Frontend developer
Task: Create attachment upload component
Constraints:
- Allow file selection
- Show upload progress
- Display uploaded files
- Allow description input
- Handle errors gracefully
- Use [your framework] patterns
Inputs: [API client, UI design]
Output format: Upload component
Evaluation: Can upload files, see progress, handle errors
```

### Step 2: Implement page creation

**Backend endpoint**:

```text
Role: Backend developer
Task: Implement page creation endpoint
Constraints:
- Endpoint: POST /api/pages
- Accept: { text: string, attachment_ids: number[] }
- Validate: text not empty, attachment_ids exist
- Create: Page and PageAttachment records
- Return: Page object with attachment
- Include error handling
Inputs: [Database models, validation patterns]
Output format: Page creation endpoint + tests
Evaluation: Can create pages, link attachment, validation works
```

**Get page endpoint**:

```text
Role: Backend developer
Task: Implement get page endpoint
Constraints:
- Endpoint: GET /api/pages/{id}
- Return: Page with associated attachment
- Handle: 404 if not found
- Include error handling
Inputs: [Page model, relationships]
Output format: Get page endpoint + tests
Evaluation: Returns page with attachment, handles 404
```

### Step 3: Implement scheduling

**Schedule endpoint**:

```text
Role: Backend developer
Task: Implement schedule endpoint
Constraints:
- Endpoint: POST /api/schedules
- Accept: { page_id: number, scheduled_at?: datetime }
- Default: scheduled_at = now (imattachmentte)
- Create: Schedule record with status "queued"
- Validate: page exists, scheduled_at in future (if provided)
- Return: Schedule object
Inputs: [Schedule model, Page model]
Output format: Schedule endpoint + tests
Evaluation: Can schedule pages, validation works
```

**List schedules endpoint**:

```text
Role: Backend developer
Task: Implement list schedules endpoint
Constraints:
- Endpoint: GET /api/schedules
- Return: List of schedules with page info
- Filter: optional status filter
- Sort: by scheduled_at
- Include error handling
Inputs: [Schedule model, relationships]
Output format: List schedules endpoint + tests
Evaluation: Returns schedules, filtering works
```

### Step 4: Implement scheduler/worker

**Background scheduler**:

```text
Role: Backend developer
Task: Implement background scheduler for queued pages
Constraints:
- Check for queued schedules every [interval] seconds
- Process schedules where scheduled_at <= now
- Call publish service
- Update schedule status (queued → pageed/failed)
- Handle errors and retries
- Limit concurrent processing
Inputs: [Schedule model, publish service]
Output format: Scheduler implementation
Evaluation: Processes queued pages, updates status, handles errors
```

**Publish service**:

```text
Role: Backend developer
Task: Implement publish service
Constraints:
- Take: page_id
- Get: page with attachment
- Call: provider.publish()
- Log: PublishLog entry
- Update: schedule status
- Handle: errors and retries
Inputs: [Page model, provider interface]
Output format: Publish service + tests
Evaluation: Publishes pages, logs results, handles errors
```

### Step 5: Implement publish endpoint

**Publish now endpoint**:

```text
Role: Backend developer
Task: Implement publish now endpoint
Constraints:
- Endpoint: POST /api/providers/default/publish
- Accept: { page_id: number }
- Call: publish service
- Return: PublishLog with status
- Include error handling
Inputs: [Publish service, provider]
Output format: Publish endpoint + tests
Evaluation: Can publish imattachmenttely, returns status
```

### Step 6: Build compose UI

**Compose page**:

```text
Role: Frontend developer
Task: Create compose page for creating pages
Constraints:
- Text input for page content
- Attachment upload section
- Preview of page
- Create page button
- Show success/error messages
- Use [your framework] patterns
Inputs: [API client, UI components]
Output format: Compose page component
Evaluation: Can create pages, upload attachment, see preview
```

### Step 7: Build schedules UI

**Schedules page**:

```text
Role: Frontend developer
Task: Create schedules page
Constraints:
- List all schedules
- Show: page text, scheduled time, status
- Filter by status
- Refresh button
- Use [your framework] patterns
Inputs: [API client, UI components]
Output format: Schedules page component
Evaluation: Can view schedules, filter, refresh
```

## Testing

### Test attachment upload

```text
Role: Test engineer
Task: Write tests for attachment upload
Constraints:
- Test: successful upload
- Test: file validation (type, size)
- Test: description handling
- Test: error cases
- Use [your testing framework]
Inputs: [Attachment upload endpoint]
Output format: Test file
Evaluation: All tests pass
```

### Test page creation

```text
Role: Test engineer
Task: Write tests for page creation
Constraints:
- Test: create page with text
- Test: create page with attachment
- Test: validation (empty text, invalid attachment_ids)
- Test: get page endpoint
- Use [your testing framework]
Inputs: [Page endpoints]
Output format: Test file
Evaluation: All tests pass
```

### Test scheduling

```text
Role: Test engineer
Task: Write tests for scheduling
Constraints:
- Test: schedule page
- Test: imattachmentte schedule (no scheduled_at)
- Test: future schedule
- Test: validation
- Test: scheduler processes queued pages
- Use [your testing framework]
Inputs: [Schedule endpoints, scheduler]
Output format: Test file
Evaluation: All tests pass
```

### Test publishing

```text
Role: Test engineer
Task: Write tests for publishing
Constraints:
- Test: publish now endpoint
- Test: publish service with stub provider
- Test: error handling
- Test: publish log creation
- Use [your testing framework]
Inputs: [Publish endpoint, service]
Output format: Test file
Evaluation: All tests pass
```

## Integration testing

**E2E flow test**:

```text
Role: Test engineer
Task: Write E2E test for complete flow
Constraints:
- Test: upload attachment → create page → schedule → publish
- Use stub provider
- Verify: all steps work together
- Use [your E2E testing framework]
Inputs: [All endpoints, scheduler]
Output format: E2E test
Evaluation: Complete flow works end-to-end
```

## Verification checklist

Before moving to M3, verify:

- [ ] Can upload attachment files
- [ ] Can create pages with text and attachment
- [ ] Can schedule pages (imattachmentte and future)
- [ ] Scheduler processes queued pages
- [ ] Can publish pages imattachmenttely
- [ ] Can view schedules and status
- [ ] UI works for compose and schedules
- [ ] All tests pass
- [ ] Error handling works

## Troubleshooting

### Issue: Attachment upload fails

**Solutions**:

- Check file size limits
- Verify storage path exists
- Check file permissions
- Review error logs

### Issue: Scheduler not running

**Solutions**:

- Verify scheduler is started
- Check interval configuration
- Review scheduler logs
- Test manually

### Issue: Pages not publishing

**Solutions**:

- Check stub provider is working
- Verify publish service is called
- Review error logs
- Test provider directly

## Next steps

Once M2 is complete, proceed to **[M3: AI-Assisted Content Generation](./06.3-milestone-3-ai-features.md)**

## Deliverables

- Attachment upload working
- Page creation working
- Scheduling system working
- Publishing flow working
- Basic UI for compose and schedules
- Scheduler processing queued pages
- Tests passing

