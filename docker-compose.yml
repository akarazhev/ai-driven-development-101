version: "3.9"
services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: docker
      APP_DATABASE_URL: jdbc:sqlite:///data/app.db
      APP_MEDIA_DIR: /storage/media
      APP_PROVIDER: stub
      APP_SCHEDULER_INTERVAL_SECONDS: 5
      APP_CORS_ORIGINS: 'http://localhost:4200,http://localhost:8080,http://localhost:5173'
    volumes:
      - data:/data
      - media:/storage/media

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
      args:
        NG_APP_API_BASE: http://localhost:8080
    ports:
      - "8080:80"
    depends_on:
      - backend

volumes:
  data:
  media:
