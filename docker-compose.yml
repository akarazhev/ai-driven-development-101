version: "3.9"
services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: docker
      APP_DATABASE_URL: jdbc:sqlite:///data/app.db
      APP_ATTACHMENT_DIR: /storage/attachments
      APP_CONFLUENCE_URL: https://your-domain.atlassian.net
      APP_CONFLUENCE_DEFAULT_SPACE: DEV
      APP_CONFLUENCE_API_TOKEN: ${CONFLUENCE_API_TOKEN:-}
      APP_PROVIDER: confluence-stub
      APP_SCHEDULER_INTERVAL_SECONDS: 5
      APP_CORS_ORIGINS: 'http://localhost:4200,http://localhost:8080,http://localhost:5173'
    volumes:
      - data:/data
      - attachments:/storage/attachments

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
      args:
        NG_APP_API_BASE: http://localhost:8080
    ports:
      - "8080:80"
    depends_on:
      - backend

volumes:
  data:
  attachments:
